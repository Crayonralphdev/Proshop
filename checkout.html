<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ProShop | Checkout</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
:root{
  --primary:#1f6fae;
  --accent:#f97316;
  --light:#f4f8ff;
  --dark:#0f172a;
  --card:#ffffff;
  --gray:#64748b;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins',sans-serif}
body{background:var(--light);color:var(--dark);}

.container{max-width:800px;margin:50px auto;padding:20px;}
h1{text-align:center;color:var(--primary);margin-bottom:20px;}

.checkout-item{
  display:flex;
  align-items:center;
  background:var(--card);
  padding:10px;
  margin-bottom:10px;
  border-radius:10px;
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
  flex-wrap:wrap;
}

.checkout-item img{
  width:80px;height:80px;object-fit:cover;border-radius:8px;
}

.checkout-item-details{flex:1;margin-left:15px;}
.checkout-item-details h3{margin-bottom:5px;}
.checkout-item-details p{margin-bottom:5px;color:var(--gray);}

.total-section{
  text-align:right;
  margin-top:20px;
  font-size:18px;
  font-weight:600;
}

form{
  margin-top:30px;
  display:flex;
  flex-direction:column;
  gap:15px;
}

form input, form textarea{
  padding:10px;
  border-radius:8px;
  border:1px solid var(--gray);
  font-size:14px;
  width:100%;
}

.pay-btn{
  padding:12px;
  background:var(--accent);
  color:#fff;
  border:none;
  border-radius:10px;
  font-size:16px;
  cursor:pointer;
}

/* RECEIPT MODAL */
#receiptModal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.5);
  justify-content:center;
  align-items:center;
  z-index:9999;
}

#receiptContent{
  background:white;
  padding:20px;
  border-radius:12px;
  width:90%;
  max-width:520px;
  max-height:90vh;
  overflow-y:auto; /* scroll if content is too long */
  box-shadow:0 5px 20px rgba(0,0,0,0.2);
}

#receiptContent h2{color:var(--primary);margin-bottom:10px;text-align:center;}
#receiptDetails{font-size:14px;color:var(--dark);}
.receipt-header{text-align:center;margin-bottom:20px;}
.receipt-header img{max-width:100px;margin-bottom:10px;}
.receipt-table{width:100%;border-collapse:collapse;margin-top:10px;}
.receipt-table th, .receipt-table td{border:1px solid #ccc;padding:8px;text-align:left;}
.receipt-table th{background:var(--primary);color:#fff;}
.receipt-footer{margin-top:15px;font-weight:700;font-size:16px;text-align:right;}

.modal-btn{
  margin-top:15px;
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  font-size:16px;
  cursor:pointer;
}

#modalPayBtn{background:var(--primary);color:white;}
#downloadBtn{background:var(--accent);color:white;}

@media(max-width:500px){
  .checkout-item{flex-direction:column;align-items:flex-start;}
  .checkout-item img{margin-bottom:10px;}
}
</style>
</head>
<body>

<div class="container">
  <h1>Checkout</h1>

  <div id="checkoutItems"></div>

  <div class="total-section">
    Total: ₦<span id="checkoutTotal">0</span>
  </div>

  <form id="checkoutForm">
    <input type="text" name="name" placeholder="Full Name" required>
    <textarea name="address" placeholder="Delivery Address" rows="3" required></textarea>
    <input type="tel" name="phone" placeholder="Phone Number" required>
    <button type="submit" class="pay-btn">Generate Receipt</button>
  </form>
</div>

<!-- RECEIPT MODAL -->
<div id="receiptModal">
  <div id="receiptContent">
    <div class="receipt-header">
      <img src="https://via.placeholder.com/100x50?text=ProShop+Logo" alt="Logo">
      <h2>ProShop Invoice</h2>
    </div>
    <div id="receiptDetails"></div>
    <button class="modal-btn" id="modalPayBtn">Pay</button>
    <button class="modal-btn" id="downloadBtn">Download Receipt</button>
  </div>
</div>

<script>
let cart = JSON.parse(localStorage.getItem('cart')) || [];

function renderCheckout(){
  const container = document.getElementById('checkoutItems');
  container.innerHTML = '';
  let total = 0;
  if(cart.length===0){
    container.innerHTML='<p style="text-align:center;color:#64748b">Your cart is empty!</p>';
    document.getElementById('checkoutTotal').textContent='0';
    return;
  }

  cart.forEach(item=>{
    const qty = item.qty||1;
    const price = Number(item.price)||0;
    total += price*qty;

    const div=document.createElement('div');
    div.className='checkout-item';
    div.innerHTML=`
      <img src="${item.img}">
      <div class="checkout-item-details">
        <h3>${item.name}</h3>
        <p>Price: ₦${price}</p>
        <p>Quantity: ${qty}</p>
      </div>
    `;
    container.appendChild(div);
  });
  document.getElementById('checkoutTotal').textContent=total;
}

// Handle checkout
document.getElementById('checkoutForm').addEventListener('submit', e=>{
  e.preventDefault();
  if(cart.length===0) return alert("Cart is empty!");

  const formData=new FormData(e.target);
  const name=formData.get('name');
  const address=formData.get('address');
  const phone=formData.get('phone');
  const total=document.getElementById('checkoutTotal').textContent;
  const date = new Date().toLocaleDateString();
  const orderNumber = Math.floor(Math.random()*1000000);

  let receiptHTML = `<p><strong>Name:</strong> ${name}</p>
                     <p><strong>Phone:</strong> ${phone}</p>
                     <p><strong>Address:</strong> ${address}</p>
                     <p><strong>Date:</strong> ${date}</p>
                     <p><strong>Order #:</strong> ${orderNumber}</p>`;

  receiptHTML += `<table class="receipt-table">
                    <tr>
                      <th>Item</th>
                      <th>Qty</th>
                      <th>Price</th>
                      <th>Subtotal</th>
                    </tr>`;

  cart.forEach(item=>{
    const qty=item.qty||1;
    const price=Number(item.price)||0;
    const subtotal=qty*price;
    receiptHTML += `<tr>
                      <td>${item.name}</td>
                      <td>${qty}</td>
                      <td>₦${price}</td>
                      <td>₦${subtotal}</td>
                    </tr>`;
  });

  receiptHTML += `</table>`;
  receiptHTML += `<div class="receipt-footer">Total: ₦${total}</div>`;

  document.getElementById('receiptDetails').innerHTML=receiptHTML;
  document.getElementById('receiptModal').style.display='flex';
});

// Download receipt as image & close modal automatically
document.getElementById('downloadBtn').addEventListener('click', ()=>{
  html2canvas(document.getElementById('receiptContent')).then(canvas=>{
    const link=document.createElement('a');
    link.download='receipt.png';
    link.href=canvas.toDataURL('image/png');
    link.click();

    // Automatically close modal after 1 second
    setTimeout(()=>{
      document.getElementById('receiptModal').style.display='none';
    }, 1000);
  });
});

// Pay button placeholder
document.getElementById('modalPayBtn').addEventListener('click', ()=>{
  alert("Payment system will be connected here.");
});

renderCheckout();
</script>

</body>
</html>
// Pay button inside modal (placeholder)
document.getElementById('modalPayBtn').addEventListener('click', ()=>{
  alert("Payment system will be connected here.");
});

// Initial render
renderCheckout();
</script>

</body>
</html>
